# 마일리지도둑 (mileage_thief)

## 개요 및 목적

마일리지도둑은 항공권 마일리지 좌석을 쉽고 빠르게 검색할 수 있도록 도와주는 Flutter 기반의 앱/웹 서비스입니다. 다양한 항공사와 노선의 마일리지 좌석 정보를 한눈에 확인하고, 상세 정보를 제공하여 사용자들의 마일리지 활용을 극대화하는 것이 목적입니다.

## 주요 기능

- **항공권 마일리지 좌석 검색**  
  다양한 조건(항공사, 노선, 날짜 등)으로 마일리지 좌석을 검색할 수 있습니다.
- **상세 정보 제공**  
  검색 결과에서 각 항공권의 상세 마일리지 정보, 좌석 등급, 필요 마일리지, 세부 조건 등을 확인할 수 있습니다.

## 보조 기능 및 향후 고도화 아이디어

- **커뮤니티 기능**  
  사용자 간 질문, 정보 공유, 좌석 알림 등 커뮤니티 게시판(예정)
- **포인트 및 등급 시스템**  
  활동에 따른 포인트 적립, 등급별 혜택 제공(예정)
- **광고 리워드 및 출석 체크**  
  광고 시청, 출석 체크, 미션 등 다양한 리워드 기능(예정)
- **데이터 시계열 저장 및 분석**  
  좌석 데이터의 시계열 저장 및 추후 머신러닝/딥러닝 분석 활용(예정)

---

문의 및 기여: [프로젝트 운영진에게 문의]
# 상품권 웹 아키텍처/UX 제안서 (입력 효율 중심)

## 1) 문제 정의

현재 앱은 `users/{uid}/...` 아래에 상품권 관련 데이터(구매 `lots`, 판매 `sales`, 카드 연결, 지점 연결, 메모 등)가 이미 잘 쌓여 있습니다.  
하지만 모바일에서는 **한 건씩 입력**이 중심이라, 아래 요구를 만족하기 어렵습니다.

- 한 번에 다건 입력(엑셀 업로드)
- 키보드/마우스 기반의 빠른 입력
- 복붙 중심 입력(표 형태)
- 입력은 빠르되, 데이터 품질(카드/지점/상품권 매핑 정확도) 유지

즉 웹의 핵심 목적은 “보여주기”도 중요하지만, 우선순위는 **구매/판매 기록 생산성 극대화**입니다.

---

## 2) 웹 목표 (우선순위)

1. **입력 속도**: 모바일 대비 3~5배 빠른 기록
2. **오류 감소**: 업로드 전 검증 + 에러 라인 즉시 수정
3. **가독성**: PC 화면에서 거래/지표를 표 + 차트로 명확히
4. **연속 작업성**: 업로드 → 검증 → 확정 → 결과 확인이 한 화면 흐름으로

---

## 3) 정보 구조(IA) 제안

모바일 탭(정보/지도/시세/지점)은 유지하되, 웹에서는 **입력 탭을 최상위로 승격**하는 것을 권장합니다.

### 웹 상단 메뉴 제안

1. **입력**
   - 빠른입력(그리드)
   - 엑셀/CSV 업로드
   - 임시저장/미완료 작업
2. **거래내역**
   - 구매/판매 통합 리스트
   - 고급 필터(기간/상품권/카드/지점/입력자)
3. **분석**
   - 대시보드 / 캘린더 / 일일(기존 정보 탭 확장)
4. **지도**
   - 월별/상품권별 지점 순위, 마커 상세
5. **시세**
   - 상품권별 시세 + 지점 비교
6. **지점**
   - 지점별 그래프/랭킹/거래 추이

핵심 포인트: 모바일의 조회 기능은 거의 그대로 옮기고, 웹의 차별점은 **입력 경험**으로 둡니다.

---

## 4) 핵심 UX: “입력”을 2개 모드로 분리

## A. 빠른입력 모드 (스프레드시트형)

**대상**: 당일 소량~중량 입력, 키보드 중심 사용자

- 행 단위 입력 표 (구매/판매 타입 혼합 가능)
- `Tab / Enter / ↑↓` 이동
- `Ctrl+C / Ctrl+V` 멀티셀 복붙
- 드롭다운 자동완성:
  - 상품권명
  - 카드
  - 지점
- 기본값/반복값 자동 채움:
  - “이전 행과 동일” 단축키
  - 오늘 날짜 기본값
- 실시간 검증:
  - 필수값 누락
  - 존재하지 않는 카드/지점
  - 금액/수량 형식 오류
- 하단에 즉시 합계:
  - 총 구매액, 총 판매액, 예상 마진

## B. 업로드 모드 (Excel/CSV)

**대상**: 월말 정리, 외부 장부/엑셀 사용자

1. 템플릿 다운로드
2. 파일 업로드
3. 컬럼 매핑 확인(자동 매핑 + 수동 수정)
4. 사전 검증 결과 표시
   - 성공 N건 / 경고 N건 / 실패 N건
5. 실패 행만 수정 후 재검증
6. 확정 저장(배치 커밋)
7. 업로드 리포트 저장(누가/언제/몇 건/오류 내역)

---

## 5) 라이언님 피드백 반영 포인트

요청: “한 번에 업로드”, “하나씩 입력 힘듦”, “웹에서 빠르게 입력”, “복붙”

반영 설계:

- **엑셀 업로드**: CSV/XLSX 모두 지원, 템플릿 제공
- **복붙 입력**: 엑셀에서 복사한 범위 그대로 그리드에 붙여넣기
- **대량 수정**: 선택 행 일괄 카드 지정/지점 지정/메모 추가
- **단축키 중심**: 마우스 최소화, Enter 기반 연속 입력

---

## 6) 데이터 아키텍처 제안 (현재 Firestore 구조 활용)

> 실제 컬렉션명은 현재 운영 구조를 기준으로 맞추되, 아래는 참조 아키텍처입니다.

### 6.1 저장소(예시)

- `users/{uid}/cards/{cardId}`
- `users/{uid}/branches/{branchId}`
- `users/{uid}/lots/{lotId}` (구매)
- `users/{uid}/sales/{saleId}` (판매)
- `users/{uid}/imports/{importId}` (업로드 이력)
- `users/{uid}/importRows/{rowId}` (선택: 행 단위 에러 추적용)

### 6.2 웹 입력 파이프라인

1. **Client(Web)**
   - 빠른입력/업로드 UI
2. **Validation API**
   - 참조 데이터(cards/branches/tickets) 검증
   - 형식/중복/비즈니스 룰 검증
3. **Import Worker**
   - 대량행 배치 처리
   - 성공/실패 분리 기록
4. **Commit**
   - `lots`, `sales`에 최종 반영
5. **Audit/Report**
   - `imports`에 결과 요약 + 실패 사유 저장

### 6.3 권장 비즈니스 룰

- 구매(`lots`) 필수: 거래일, 상품권, 수량, 단가/총액, 결제카드(선택/필수 정책 결정)
- 판매(`sales`) 필수: 거래일, 상품권, 수량, 판매가, 지점(필수 권장)
- 메모는 자유 텍스트 + 해시태그 파싱(선택)
- 동일 사용자/동일 시각/동일 값 중복 업로드 방지 키(옵션)

---

## 7) 화면 샘플 (와이어프레임)

## 7.1 빠른입력 화면

```text
+-----------------------------------------------------------------------------------+
| [입력] 빠른입력 | 엑셀업로드 | 임시저장                                          |
+-----------------------------------------------------------------------------------+
| 날짜      | 유형 | 상품권      | 수량 | 단가   | 총액   | 카드      | 지점   | 메모 |
| 2026-02-12| 구매 | 신세계10만  | 10  | 96,500 | 965,000| 현대카드A | -      |      |
| 2026-02-12| 판매 | 신세계10만  |  3  | 98,000 | 294,000| -         | 강남점 | VIP  |
| ... (Ctrl+V로 다중행 붙여넣기)                                                  |
+-----------------------------------------------------------------------------------+
| 오류: 2건 (행 8: 카드 미등록, 행 11: 수량 형식 오류)                             |
| 합계: 구매 3,250,000 / 판매 4,010,000 / 추정마진 760,000                        |
| [임시저장] [오류행만 보기] [검증 후 저장]                                         |
+-----------------------------------------------------------------------------------+
```

## 7.2 엑셀 업로드 화면

```text
1) 템플릿 다운로드  ->  2) 파일 업로드  ->  3) 컬럼 매핑  ->  4) 검증  ->  5) 저장

[파일] 2026-02-구매판매.xlsx
[시트] Sheet1

자동매핑 결과
- trade_date  <- A열(거래일)
- type        <- B열(구매/판매)
- ticket_name <- C열(상품권명)
- qty         <- D열(수량)
- unit_price  <- E열(단가)
- card_name   <- F열(카드명)
- branch_name <- G열(지점명)
- memo        <- H열(메모)

검증 결과: 총 1,240행 / 성공 1,210 / 경고 12 / 실패 18
[실패행 다운로드] [실패행 인라인 수정] [확정 저장]
```

---

## 8) 업로드 템플릿 샘플

## 8.1 CSV 헤더

```csv
trade_date,type,ticket_name,qty,unit_price,total_amount,card_name,branch_name,memo
```

## 8.2 샘플 데이터

```csv
2026-02-12,buy,신세계10만,10,96500,965000,현대카드A,,오전 일괄매입
2026-02-12,sell,신세계10만,3,98000,294000,,강남점,VIP 고객 판매
2026-02-12,buy,롯데5만,20,48200,964000,신한카드B,,월초 물량
```

> `type`은 내부적으로 `buy/sell`로 고정하면 검증이 단순해집니다.  
> 화면에서는 “구매/판매” 한글 라벨로 보여주면 됩니다.

---

## 9) 성능/운영 고려사항

- 대량 업로드는 동기 저장보다 **비동기 작업큐** 권장
- 1회 업로드 최대 행 수 제한(예: 5,000행)
- 저장 전 검증 단계에서 참조데이터 캐싱(cards/branches)으로 응답속도 확보
- 실패 행 재처리 기능 필수(전체 재업로드 방지)
- 업로드 이력(감사로그) 유지로 CS 대응 용이

---

## 10) 권한/보안

- 사용자별 `uid` 스코프 강제 (타 사용자 데이터 접근 차단)
- 업로드 파일 원본은 단기 보관(보안 정책 기반)
- 주요 이벤트 로그:
  - 업로드 시작/완료
  - 몇 건 성공/실패
  - 누가 확정했는지

---

## 11) 단계별 도입 로드맵 (권장)

### Phase 1 (가장 빠른 가치)

- 빠른입력 그리드(복붙 + 단축키)
- CSV 업로드 + 사전검증 + 저장
- 기본 업로드 리포트

### Phase 2

- XLSX 다중시트 지원
- 실패행 인라인 수정/재검증
- 일괄 수정(카드/지점/메모)

### Phase 3

- 고급 자동매핑(과거 패턴 학습)
- 업로드 추천 규칙(자주 쓰는 카드/지점 자동제안)

---

## 12) 성공 지표(KPI)

- 입력 시간(100건 기준): 기존 대비 60% 이상 단축
- 업로드 성공률: 95% 이상
- 입력 오류율: 30% 이상 감소
- 주간 웹 입력 비중: 모바일 대비 지속 상승

---

## 13) 결론

웹에서 가장 효율적인 방향은 **“조회 확장”보다 “입력 혁신” 우선**입니다.  
즉, 기존 앱의 정보/지도/시세/지점은 PC에서 더 보기 좋게 확장하되, 핵심은 아래 2축입니다.

1. **스프레드시트형 빠른입력(복붙/단축키)**
2. **엑셀 업로드 + 검증 + 실패행 재처리**

이 두 축만 제대로 구현해도 라이언님 같은 고빈도 사용자에게 즉시 체감 가치를 줄 수 있습니다.


